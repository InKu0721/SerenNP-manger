import{c as m,r,z as i,j as e}from"./index-C5px4MfY.js";import{P as I,T as M,U as $}from"./user-CU97xRpH.js";import{S as b}from"./search-Di1kyn06.js";import{R as C}from"./refresh-cw-IkhiQzU1.js";import{T as G}from"./trash-2-C28K0-Y6.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=m("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=m("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=m("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=m("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=m("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function X({onEdit:A,onNew:S}){const[y,w]=r.useState([]),[g,f]=r.useState(!0),[p,v]=r.useState(""),[o,N]=r.useState(""),[d,k]=r.useState(""),[P,L]=r.useState([]),[u,O]=r.useState(!1);r.useEffect(()=>{x(),D()},[]),r.useEffect(()=>{p||o||d?E():x()},[p,o,d]);const x=async()=>{var s,t,n;try{if(f(!0),(n=(t=(s=window.go)==null?void 0:s.main)==null?void 0:t.App)!=null&&n.GetAllPOCs){const a=await window.go.main.App.GetAllPOCs();w(a||[])}}catch(a){i.error("加载模板失败"),console.error(a)}finally{f(!1)}},D=async()=>{var s,t,n;try{if((n=(t=(s=window.go)==null?void 0:s.main)==null?void 0:t.App)!=null&&n.GetCategories){const a=await window.go.main.App.GetCategories();L(a||[])}}catch(a){console.error(a)}},E=async()=>{var s,t,n;try{if((n=(t=(s=window.go)==null?void 0:s.main)==null?void 0:t.App)!=null&&n.SearchPOCs){const a=await window.go.main.App.SearchPOCs(p,o,d);w(a||[])}}catch(a){console.error(a)}},T=async s=>{var t,n,a;if(confirm("确定要删除这个模板吗？"))try{(a=(n=(t=window.go)==null?void 0:t.main)==null?void 0:n.App)!=null&&a.DeletePOC&&(await window.go.main.App.DeletePOC(s),i.success("删除成功"),x())}catch{i.error("删除失败")}},U=async s=>{var t,n,a;try{if((a=(n=(t=window.go)==null?void 0:t.main)==null?void 0:n.App)!=null&&a.ExportPOC){const c=await window.go.main.App.ExportPOC(s),j=new Blob([c],{type:"text/yaml"}),h=URL.createObjectURL(j),l=document.createElement("a");l.href=h,l.download=`${s}.yaml`,l.click(),URL.revokeObjectURL(h),i.success("导出成功")}}catch{i.error("导出失败")}},R=async()=>{const s=document.createElement("input");s.type="file",s.accept=".yaml,.yml",s.onchange=async t=>{var c,j,h,l;const n=(c=t.target.files)==null?void 0:c[0];if(!n)return;const a=await n.text();try{(l=(h=(j=window.go)==null?void 0:j.main)==null?void 0:h.App)!=null&&l.ImportPOC&&(await window.go.main.App.ImportPOC(a),i.success("导入成功"),x())}catch{i.error("导入失败: 无效的 YAML 格式")}},s.click()},F=s=>({critical:"severity-critical",high:"severity-high",medium:"severity-medium",low:"severity-low",info:"severity-info"})[s==null?void 0:s.toLowerCase()]||"severity-info";return e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"POC 模板管理"}),e.jsx("p",{className:"text-dark-400",children:"管理和编辑您的漏洞检测模板"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:R,className:"btn btn-secondary",children:[e.jsx(B,{className:"w-4 h-4"}),"导入"]}),e.jsxs("button",{onClick:S,className:"btn btn-primary",children:[e.jsx(I,{className:"w-4 h-4"}),"新建模板"]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-500"}),e.jsx("input",{type:"text",placeholder:"搜索模板名称、描述或 ID...",value:p,onChange:s=>v(s.target.value),className:"w-full pl-10"})]}),e.jsxs("button",{onClick:()=>O(!u),className:`btn ${u?"btn-primary":"btn-secondary"}`,children:[e.jsx(Q,{className:"w-4 h-4"}),"过滤"]}),e.jsx("button",{onClick:x,className:"btn btn-secondary",children:e.jsx(C,{className:`w-4 h-4 ${g?"animate-spin":""}`})})]}),u&&e.jsxs("div",{className:"flex gap-4 mt-4 pt-4 border-t border-dark-700",children:[e.jsxs("select",{value:o,onChange:s=>N(s.target.value),className:"min-w-[150px]",children:[e.jsx("option",{value:"",children:"所有分类"}),P.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:d,onChange:s=>k(s.target.value),className:"min-w-[150px]",children:[e.jsx("option",{value:"",children:"所有严重程度"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"info",children:"Info"})]}),e.jsx("button",{onClick:()=>{N(""),k(""),v("")},className:"text-dark-400 hover:text-dark-200 text-sm",children:"清除过滤"})]})]}),e.jsx("div",{className:"card overflow-hidden",children:g?e.jsxs("div",{className:"p-12 text-center text-dark-400",children:[e.jsx(C,{className:"w-8 h-8 mx-auto mb-3 animate-spin"}),e.jsx("p",{children:"加载中..."})]}):y.length===0?e.jsxs("div",{className:"p-12 text-center text-dark-400",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"暂无模板"}),e.jsx("p",{className:"text-sm",children:'点击"新建模板"开始创建'})]}):e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"名称"}),e.jsx("th",{children:"严重程度"}),e.jsx("th",{children:"分类"}),e.jsx("th",{children:"作者"}),e.jsx("th",{children:"更新时间"}),e.jsx("th",{className:"w-32",children:"操作"})]})}),e.jsx("tbody",{children:y.map((s,t)=>e.jsxs("tr",{className:"animate-slide-in",style:{animationDelay:`${t*30}ms`},children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:s.name||s.id}),e.jsx("div",{className:"text-sm text-dark-500 truncate max-w-md",children:s.description||"暂无描述"})]})}),e.jsx("td",{children:e.jsx("span",{className:`tag ${F(s.severity)}`,children:s.severity||"info"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1 text-dark-400",children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:s.category||"-"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1 text-dark-400",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{children:s.author||"-"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1 text-dark-500 text-sm",children:[e.jsx(z,{className:"w-3 h-3"}),e.jsx("span",{children:s.updatedAt?new Date(s.updatedAt).toLocaleDateString("zh-CN"):"-"})]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(s),className:`p-2 rounded-lg hover:bg-dark-700 text-dark-400 \r
                                 hover:text-cyber-400 transition-colors`,title:"编辑",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>U(s.id),className:`p-2 rounded-lg hover:bg-dark-700 text-dark-400 \r
                                 hover:text-blue-400 transition-colors`,title:"导出",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(s.id),className:`p-2 rounded-lg hover:bg-dark-700 text-dark-400 \r
                                 hover:text-red-400 transition-colors`,title:"删除",children:e.jsx(G,{className:"w-4 h-4"})})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-dark-500",children:[e.jsxs("span",{children:["共 ",y.length," 个模板"]}),e.jsx("span",{children:o||d?"已应用过滤条件":"显示全部"})]})]})}export{X as default};
