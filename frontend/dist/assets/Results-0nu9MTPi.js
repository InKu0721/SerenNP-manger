import{c as E,r as n,j as e,C as M,F as H,z as A}from"./index-C5px4MfY.js";import{S as x,X as V,F as $}from"./x-By0me3VG.js";import{C as j}from"./copy-PY17_3vm.js";import{R as D}from"./refresh-cw-IkhiQzU1.js";import{S as J}from"./search-Di1kyn06.js";import{C as X,a as _}from"./chevron-right-kSdhYXZR.js";import{A as K}from"./alert-triangle-BGl7UauM.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=E("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=E("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);function re({initialScanId:m,onViewPOC:k}){const[P,z]=n.useState([]),[i,N]=n.useState(m||""),[h,O]=n.useState([]),[y,C]=n.useState(!1),[g,G]=n.useState(null),[o,w]=n.useState(""),[l,f]=n.useState(null),[v,S]=n.useState("request");n.useEffect(()=>{L()},[]),n.useEffect(()=>{m&&N(m)},[m]),n.useEffect(()=>{i&&R(i)},[i]);const L=async()=>{var s,a,r;try{if((r=(a=(s=window.go)==null?void 0:s.main)==null?void 0:a.App)!=null&&r.GetAllScans){const t=await window.go.main.App.GetAllScans();z(t||[]),t&&t.length>0&&!i&&N(t[0].id)}}catch(t){console.error(t)}},R=async s=>{var a,r,t;C(!0);try{if((t=(r=(a=window.go)==null?void 0:a.main)==null?void 0:r.App)!=null&&t.GetScanResults){const c=await window.go.main.App.GetScanResults(s);O(c||[])}}catch(c){console.error(c)}finally{C(!1)}},T=async s=>{var a,r,t;try{if((t=(r=(a=window.go)==null?void 0:a.main)==null?void 0:r.App)!=null&&t.GetPOCByID){const c=await window.go.main.App.GetPOCByID(s);c&&k&&k(c)}}catch{A.error("无法加载 POC 信息")}},p=s=>{navigator.clipboard.writeText(s),A.success("已复制到剪贴板")},F=s=>({critical:"severity-critical",high:"severity-high",medium:"severity-medium",low:"severity-low",info:"severity-info"})[s==null?void 0:s.toLowerCase()]||"severity-info",I=s=>({critical:"bg-red-500/10 border-red-500/30",high:"bg-orange-500/10 border-orange-500/30",medium:"bg-yellow-500/10 border-yellow-500/30",low:"bg-blue-500/10 border-blue-500/30",info:"bg-cyan-500/10 border-cyan-500/30"})[s==null?void 0:s.toLowerCase()]||"bg-cyan-500/10 border-cyan-500/30",u=o?h.filter(s=>{var a;return((a=s.severity)==null?void 0:a.toLowerCase())===o}):h,d=h.reduce((s,a)=>{var t;const r=((t=a.severity)==null?void 0:t.toLowerCase())||"info";return s[r]=(s[r]||0)+1,s},{});return e.jsxs("div",{className:"p-8 space-y-6",children:[l&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-dark-900 border border-dark-700 rounded-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{className:"w-5 h-5 text-cyber-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:l.templateName||l.templateId}),e.jsx("p",{className:"text-sm text-dark-400",children:l.host})]})]}),e.jsx("button",{onClick:()=>f(null),className:"p-2 rounded-lg hover:bg-dark-700 text-dark-400 hover:text-white",children:e.jsx(V,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-dark-700",children:[e.jsxs("button",{onClick:()=>S("request"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors
                          ${v==="request"?"text-cyber-400 border-b-2 border-cyber-400 bg-cyber-500/5":"text-dark-400 hover:text-dark-200"}`,children:[e.jsx(x,{className:"w-4 h-4 inline mr-2"}),"请求包"]}),e.jsxs("button",{onClick:()=>S("response"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors
                          ${v==="response"?"text-cyber-400 border-b-2 border-cyber-400 bg-cyber-500/5":"text-dark-400 hover:text-dark-200"}`,children:[e.jsx($,{className:"w-4 h-4 inline mr-2"}),"响应包"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:v==="request"?l.request?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>p(l.request||""),className:`absolute top-2 right-2 p-2 rounded-lg bg-dark-700 hover:bg-dark-600 
                               text-dark-400 hover:text-white transition-colors`,children:e.jsx(j,{className:"w-4 h-4"})}),e.jsx("pre",{className:`p-4 rounded-lg bg-dark-950 text-green-400 font-mono text-sm 
                                  overflow-x-auto whitespace-pre-wrap break-all`,children:l.request})]}):e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx(x,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"无请求数据"})]}):l.response?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>p(l.response||""),className:`absolute top-2 right-2 p-2 rounded-lg bg-dark-700 hover:bg-dark-600 
                               text-dark-400 hover:text-white transition-colors`,children:e.jsx(j,{className:"w-4 h-4"})}),e.jsx("pre",{className:`p-4 rounded-lg bg-dark-950 text-cyan-400 font-mono text-sm 
                                  overflow-x-auto whitespace-pre-wrap break-all`,children:l.response})]}):e.jsxs("div",{className:"text-center py-12 text-dark-500",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{children:"无响应数据"})]})}),l.matched&&e.jsxs("div",{className:"p-4 border-t border-dark-700 bg-dark-800/50",children:[e.jsx("div",{className:"text-sm text-dark-400 mb-2",children:"匹配内容:"}),e.jsx("code",{className:`block p-3 rounded-lg bg-orange-500/10 text-orange-400 
                               font-mono text-sm border border-orange-500/20`,children:l.matched})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"扫描结果"}),e.jsx("p",{className:"text-dark-400",children:"查看和分析漏洞扫描发现"})]}),e.jsxs("button",{onClick:()=>{L(),i&&R(i)},className:"btn btn-secondary",children:[e.jsx(D,{className:`w-4 h-4 ${y?"animate-spin":""}`}),"刷新"]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-dark-400 mb-1",children:"选择扫描任务"}),e.jsxs("select",{value:i,onChange:s=>N(s.target.value),className:"w-full",children:[e.jsx("option",{value:"",children:"选择扫描任务..."}),P.map(s=>e.jsxs("option",{value:s.id,children:[s.id," - ",s.status," (",s.found," 发现)"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-dark-400 mb-1",children:"严重程度过滤"}),e.jsxs("select",{value:o,onChange:s=>w(s.target.value),className:"min-w-[150px]",children:[e.jsx("option",{value:"",children:"全部"}),e.jsxs("option",{value:"critical",children:["Critical (",d.critical||0,")"]}),e.jsxs("option",{value:"high",children:["High (",d.high||0,")"]}),e.jsxs("option",{value:"medium",children:["Medium (",d.medium||0,")"]}),e.jsxs("option",{value:"low",children:["Low (",d.low||0,")"]}),e.jsxs("option",{value:"info",children:["Info (",d.info||0,")"]})]})]})]})}),h.length>0&&e.jsx("div",{className:"grid grid-cols-5 gap-4",children:["critical","high","medium","low","info"].map(s=>e.jsxs("div",{onClick:()=>w(o===s?"":s),className:`card p-4 text-center cursor-pointer transition-all
                        ${o===s?"ring-2 ring-cyber-500":"hover:border-dark-600"}`,children:[e.jsx("div",{className:`text-2xl font-bold font-mono mb-1
                            ${s==="critical"?"text-red-400":s==="high"?"text-orange-400":s==="medium"?"text-yellow-400":s==="low"?"text-blue-400":"text-cyan-400"}`,children:d[s]||0}),e.jsx("div",{className:"text-xs text-dark-500 capitalize",children:s})]},s))}),e.jsx("div",{className:"card overflow-hidden",children:y?e.jsxs("div",{className:"p-12 text-center text-dark-400",children:[e.jsx(D,{className:"w-8 h-8 mx-auto mb-3 animate-spin"}),e.jsx("p",{children:"加载中..."})]}):i?u.length===0?e.jsxs("div",{className:"p-12 text-center text-dark-400",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"暂无发现"}),e.jsx("p",{className:"text-sm",children:"该扫描任务未发现任何漏洞"})]}):e.jsx("div",{className:"divide-y divide-dark-700/50",children:u.map((s,a)=>{var r,t,c,q;return e.jsxs("div",{className:`animate-slide-in border-l-4 ${I(s.severity).replace("bg-","border-").replace("/10","")}`,style:{animationDelay:`${a*50}ms`},children:[e.jsxs("div",{onClick:()=>G(g===s.id?null:s.id),className:"flex items-center gap-4 p-4 cursor-pointer hover:bg-dark-800/50 transition-colors",children:[e.jsx("div",{className:"text-dark-500",children:g===s.id?e.jsx(X,{className:"w-5 h-5"}):e.jsx(_,{className:"w-5 h-5"})}),e.jsx(K,{className:`w-5 h-5
                    ${((r=s.severity)==null?void 0:r.toLowerCase())==="critical"?"text-red-400":((t=s.severity)==null?void 0:t.toLowerCase())==="high"?"text-orange-400":((c=s.severity)==null?void 0:c.toLowerCase())==="medium"?"text-yellow-400":((q=s.severity)==null?void 0:q.toLowerCase())==="low"?"text-blue-400":"text-cyan-400"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-white font-medium",children:s.templateName||s.templateId}),e.jsx("span",{className:`tag ${F(s.severity)}`,children:s.severity})]}),e.jsx("div",{className:"text-sm text-dark-400 truncate mt-1",children:s.host})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(s.request||s.response)&&e.jsxs("button",{onClick:b=>{b.stopPropagation(),f(s)},className:"btn btn-secondary btn-sm",title:"查看请求/响应",children:[e.jsx(x,{className:"w-4 h-4"}),"查看数据包"]}),e.jsx("div",{className:"text-xs text-dark-500",children:new Date(s.timestamp).toLocaleString("zh-CN")})]})]}),g===s.id&&e.jsxs("div",{className:"px-4 pb-4 pl-14 space-y-4 bg-dark-800/30",children:[s.matched&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-dark-400 mb-2",children:"匹配内容"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:`flex-1 p-3 rounded-lg bg-dark-900 text-cyber-400 
                                         font-mono text-sm break-all`,children:s.matched}),e.jsx("button",{onClick:()=>p(s.matched),className:`p-2 rounded-lg hover:bg-dark-700 text-dark-400 
                                     hover:text-white transition-colors`,children:e.jsx(j,{className:"w-4 h-4"})})]})]}),s.extractedData&&Object.keys(s.extractedData).length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-dark-400 mb-2",children:"提取数据"}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.extractedData).map(([b,B])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-dark-500 text-sm",children:[b,":"]}),e.jsx("code",{className:`px-2 py-1 rounded bg-dark-900 text-dark-200 
                                             font-mono text-sm`,children:B})]},b))})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>T(s.templateId),className:"btn btn-primary btn-sm",children:[e.jsx(H,{className:"w-4 h-4"}),"查看 POC",e.jsx(Q,{className:"w-4 h-4"})]}),(s.request||s.response)&&e.jsxs("button",{onClick:()=>f(s),className:"btn btn-secondary btn-sm",children:[e.jsx(x,{className:"w-4 h-4"}),"请求/响应包"]}),e.jsxs("a",{href:s.host,target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary btn-sm",children:[e.jsx(U,{className:"w-4 h-4"}),"打开目标"]}),e.jsxs("button",{onClick:()=>p(JSON.stringify(s,null,2)),className:"btn btn-secondary btn-sm",children:[e.jsx(j,{className:"w-4 h-4"}),"复制详情"]})]})]})]},s.id)})}):e.jsxs("div",{className:"p-12 text-center text-dark-400",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-lg mb-2",children:"请选择扫描任务"}),e.jsx("p",{className:"text-sm",children:"从上方下拉菜单选择要查看的扫描结果"})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-dark-500",children:[e.jsxs("span",{children:["共 ",u.length," 条结果"]}),o&&e.jsx("button",{onClick:()=>w(""),className:"text-cyber-400 hover:text-cyber-300",children:"清除过滤"})]})]})}export{re as default};
