import{c as x,r as c,j as e,F as b,L as y,z as i}from"./index-C5px4MfY.js";import{Z as P}from"./zap-DnLljTK6.js";import{C as q,a as O}from"./chevron-right-kSdhYXZR.js";import{A as R}from"./alert-triangle-BGl7UauM.js";import{C as X}from"./clock-CsK5P1De.js";import{C as Z}from"./check-circle-1ppiQmE5.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=x("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=x("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=x("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=x("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function V({onViewResult:p}){const[m,v]=c.useState(""),[d,k]=c.useState([]),[l,h]=c.useState([]),[S,C]=c.useState([]),[u,j]=c.useState(!1),[f,N]=c.useState([]);c.useEffect(()=>{A(),o();const t=setInterval(o,1e3);return()=>clearInterval(t)},[]);const A=async()=>{var t,s,a;try{if((a=(s=(t=window.go)==null?void 0:t.main)==null?void 0:s.App)!=null&&a.GetAllPOCs){const r=await window.go.main.App.GetAllPOCs();k(r||[])}}catch(r){console.error(r)}},o=async()=>{var t,s,a;try{if((a=(s=(t=window.go)==null?void 0:t.main)==null?void 0:s.App)!=null&&a.GetAllScans){const r=await window.go.main.App.GetAllScans();C(r||[])}}catch(r){console.error(r)}},T=async()=>{var s,a,r;const t=m.split(`
`).map(n=>n.trim()).filter(n=>n.length>0);if(t.length===0){i.error("请输入至少一个目标");return}if(l.length===0){i.error("请选择至少一个模板");return}j(!0);try{if((r=(a=(s=window.go)==null?void 0:s.main)==null?void 0:a.App)!=null&&r.StartScan){const n=await window.go.main.App.StartScan({targets:t,templateIds:l,options:{concurrency:10,timeout:30,rateLimit:100,bulkSize:25,headless:!1}});i.success("扫描已启动"),N(G=>[...G,n]),o()}}catch(n){i.error("启动扫描失败: "+((n==null?void 0:n.message)||"未知错误"))}finally{j(!1)}},$=async t=>{var s,a,r;try{(r=(a=(s=window.go)==null?void 0:s.main)==null?void 0:a.App)!=null&&r.StopScan&&(await window.go.main.App.StopScan(t),i.success("扫描已停止"),o())}catch{i.error("停止扫描失败")}},L=t=>{h(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},z=()=>{l.length===d.length?h([]):h(d.map(t=>t.id))},M=t=>{N(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},D=t=>{switch(t){case"running":return e.jsx(y,{className:"w-5 h-5 text-cyber-400 animate-spin"});case"completed":return e.jsx(Z,{className:"w-5 h-5 text-green-400"});case"failed":return e.jsx(B,{className:"w-5 h-5 text-red-400"});case"stopped":return e.jsx(w,{className:"w-5 h-5 text-yellow-400"});default:return e.jsx(X,{className:"w-5 h-5 text-dark-400"})}},E=t=>({running:"扫描中",completed:"已完成",failed:"失败",stopped:"已停止",pending:"等待中"})[t]||t,I=t=>{switch(t){case"running":return"text-cyber-400 bg-cyber-500/20";case"completed":return"text-green-400 bg-green-500/20";case"failed":return"text-red-400 bg-red-500/20";case"stopped":return"text-yellow-400 bg-yellow-500/20";default:return"text-dark-400 bg-dark-600"}},F=(t,s)=>{const a=new Date(t).getTime(),r=s?new Date(s).getTime():Date.now(),n=Math.floor((r-a)/1e3);return n<60?`${n}秒`:n<3600?`${Math.floor(n/60)}分${n%60}秒`:`${Math.floor(n/3600)}时${Math.floor(n%3600/60)}分`},g=[...S].sort((t,s)=>{const a={running:0,pending:1,completed:2,stopped:3,failed:4};return(a[t.status]||5)-(a[s.status]||5)});return e.jsxs("div",{className:"p-8 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-white mb-2",children:"漏洞扫描器"}),e.jsx("p",{className:"text-dark-400",children:"配置目标和模板，启动漏洞扫描"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-cyber-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"扫描目标"})]}),e.jsx("p",{className:"text-sm text-dark-400",children:"每行输入一个目标 URL 或主机"}),e.jsx("textarea",{value:m,onChange:t=>v(t.target.value),placeholder:`https://example.com
https://target.com
192.168.1.1`,rows:10,className:"w-full font-mono text-sm resize-none"}),e.jsx("div",{className:"flex items-center justify-between text-sm text-dark-500",children:e.jsxs("span",{children:["目标数量: ",m.split(`
`).filter(t=>t.trim()).length]})})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-cyber-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"选择模板"})]}),e.jsx("button",{onClick:z,className:"text-sm text-cyber-400 hover:text-cyber-300",children:l.length===d.length?"取消全选":"全选"})]}),e.jsx("div",{className:"h-64 overflow-y-auto space-y-2",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-dark-500",children:[e.jsx(b,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"暂无模板"})]}):d.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer
                            transition-colors border
                            ${l.includes(t.id)?"bg-cyber-500/10 border-cyber-500/30":"bg-dark-800/50 border-dark-700/50 hover:border-dark-600"}`,children:[e.jsx("input",{type:"checkbox",checked:l.includes(t.id),onChange:()=>L(t.id),className:`w-4 h-4 rounded border-dark-600 bg-dark-700 
                             text-cyber-500 focus:ring-cyber-500/50`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-white truncate",children:t.name||t.id}),e.jsxs("div",{className:"text-xs text-dark-500",children:[t.severity," · ",t.category||"custom"]})]})]},t.id))}),e.jsxs("div",{className:"text-sm text-dark-500",children:["已选择 ",l.length," / ",d.length," 个模板"]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:T,disabled:u,className:"btn btn-primary px-12 py-4 text-lg disabled:opacity-50",children:u?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),"启动中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-5 h-5"}),"启动扫描"]})})}),g.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-cyber-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"扫描任务"}),e.jsxs("span",{className:"text-sm text-dark-500",children:["(",g.length,")"]})]}),g.map(t=>{var s,a;return e.jsxs("div",{className:"card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 cursor-pointer hover:bg-dark-800/30 transition-colors",onClick:()=>M(t.id),children:[e.jsx("div",{className:"text-dark-500",children:f.includes(t.id)?e.jsx(q,{className:"w-5 h-5"}):e.jsx(O,{className:"w-5 h-5"})}),D(t.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-white font-mono text-sm truncate",children:t.id}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${I(t.status)}`,children:E(t.status)}),t.found>0&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-orange-400",children:[e.jsx(R,{className:"w-3 h-3"}),t.found," 发现"]})]}),t.status==="running"&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-dark-500 mb-1",children:[e.jsxs("span",{children:["进度: ",t.completed," / ",t.total]}),e.jsxs("span",{children:[Math.round(t.progress),"%"]})]}),e.jsx("div",{className:"h-2 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full bg-gradient-to-r from-cyber-600 to-cyber-400 
                                   transition-all duration-300 rounded-full relative`,style:{width:`${t.progress}%`},children:e.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})})})]})]}),e.jsx("div",{className:"text-right text-xs text-dark-500",children:e.jsx("div",{children:F(t.startedAt,t.completedAt)})}),t.status==="running"&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),$(t.id)},className:"btn btn-danger btn-sm",children:[e.jsx(w,{className:"w-4 h-4"}),"停止"]}),t.status==="completed"&&t.found>0&&p&&e.jsx("button",{onClick:r=>{r.stopPropagation(),p(t.id)},className:"btn btn-primary btn-sm",children:"查看结果"})]}),f.includes(t.id)&&e.jsxs("div",{className:"px-4 pb-4 border-t border-dark-700/50 bg-dark-800/20",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 py-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-dark-800/50",children:[e.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:((s=t.targets)==null?void 0:s.length)||0}),e.jsx("div",{className:"text-xs text-dark-500",children:"目标数量"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-dark-800/50",children:[e.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:((a=t.templateIds)==null?void 0:a.length)||0}),e.jsx("div",{className:"text-xs text-dark-500",children:"模板数量"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-dark-800/50",children:[e.jsx("div",{className:"text-2xl font-bold text-cyber-400 font-mono",children:t.completed}),e.jsx("div",{className:"text-xs text-dark-500",children:"已完成"})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-dark-800/50",children:[e.jsx("div",{className:`text-2xl font-bold font-mono ${t.found>0?"text-orange-400":"text-dark-400"}`,children:t.found}),e.jsx("div",{className:"text-xs text-dark-500",children:"发现漏洞"})]})]}),t.targets&&t.targets.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-dark-500 mb-2",children:"扫描目标:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.targets.slice(0,5).map((r,n)=>e.jsx("span",{className:"text-xs px-2 py-1 rounded bg-dark-700 text-dark-300 font-mono",children:r},n)),t.targets.length>5&&e.jsxs("span",{className:"text-xs text-dark-500",children:["+",t.targets.length-5," 更多"]})]})]}),t.error&&e.jsx("div",{className:"mt-3 p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-red-400 text-sm",children:t.error})]})]},t.id)})]})]})}export{V as default};
